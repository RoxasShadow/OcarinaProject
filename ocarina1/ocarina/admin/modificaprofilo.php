<?php/* Permette di modificare il proprio profilo */// Includo le classi principaliinclude_once "../core/class.MySQL.php";include_once "../core/class.Ocarina.php";include_once "../core/class.Functions.php";include_once "../rendering/config.php";// Istanzio le classi$cms = new Ocarina;$db = new MySQL;$func = new Functions; // Prima di procedere controllo se l' utente è già loggatoif($func->logged() == 0) {	$text = 'Non risulti loggato. Devi prima effettuare il login per modificare il tuo profilo.';	// Visualizzo la pagina	$smarty->assign("titolo", "Modifica profilo");	$smarty->assign("contents", $text);	$smarty->assign("url_cms", $cms->url_cms());	$smarty->assign("url_smartytpl", $cms->url_smartytpl());	$smarty->assign("cmsversion", $cms->cmsversion());	$smarty->display("admin/index/index2.tpl");	exit;}/* START */// Prelevo il nickname$nickname = $db->nickname($_COOKIE[$func->cookie()]);if(isset($_POST['modificaprofilo'])) {	$email = $func->escape($_POST['email']);	$avatar = $func->escape($_POST['avatar']);	// Modifico il profilo	$db->connettidb(); // Mi connetto al database	$query = $db->query("UPDATE utenti SET email='$email', avatar='$avatar' WHERE nickname='$nickname'");	$db->disconnettidb(); // Mi disconnetto dal database	// Visualizzo la pagina	$text = 'Il tuo profilo è stato modificato.';	$smarty->assign("titolo", "Modifica profilo");	$smarty->assign("contents", $text);	$smarty->assign("url_cms", $cms->url_cms());	$smarty->assign("url_smartytpl", $cms->url_smartytpl());	$smarty->assign("cmsversion", $cms->cmsversion());	$smarty->display("admin/index/index2.tpl");	exit;}// Stampo i dati attualiif(!isset($_POST['modificaprofilo'])) {	$db->connettidb(); // Mi connetto al database	$query = $db->query("SELECT email, avatar FROM utenti WHERE nickname='$nickname'");	$db->disconnettidb(); // Mi disconnetto dal database	while($riga = $db->estrai($query)) {		$email = $func->rescape($riga->email);		$avatar = $func->rescape($riga->avatar);	}}// Visualizzo il form di recupero$text = 'Tramite questo form puoi modificare il tuo profilo.<br /><br /><form action="" method="post"> Email<br /> <input name="email" type="text" value="'.$email.'" /><br /><br /> Avatar<br /> <input name="avatar" type="text" value="'.$avatar.'" /><br /><br /> <input name="modificaprofilo" type="submit" value="Modifica profilo" /><br /></form>';$smarty->assign("titolo", "Modifica profilo");$smarty->assign("cookie", $db->auth($_COOKIE[$func->cookie()]));$smarty->assign("grado", $db->grado($_COOKIE[$func->cookie()]));$smarty->assign("contents", $text);$smarty->assign("url_cms", $cms->url_cms());$smarty->assign("url_smartytpl", $cms->url_smartytpl());$smarty->assign("cmsversion", $cms->cmsversion());$smarty->display("admin/index/index2.tpl");?>